# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

MonkeySnow is a ski resort weather forecast application with a React frontend and Express backend. It displays weather forecasts for multiple ski resorts with snow estimation using Kuchera ratios based on wet bulb temperature.

## Commands

### Development (runs both frontend and backend concurrently via Turbo)
```bash
npm run dev
```

### Run frontend only
```bash
npm run dev:frontend
```

### Run backend only
```bash
npm run dev:backend
```

### Build
```bash
npm run build
```

## Architecture

### Monorepo Structure
- Uses npm workspaces with Turbo for task orchestration
- `frontend/` - Vite + React + TypeScript + Tailwind
- `backend/` - Express + TypeScript (ts-node)

### Backend (`backend/server.ts`)
- Express server on port 1234
- Fetches weather data from Open-Meteo API for all resorts every 5 hours
- Caches weather data in memory (`weatherCache`)
- Resort locations stored in `backend/locations.json` with bot/mid/top elevations and coordinates
- Snow estimation algorithm uses wet bulb temperature and Kuchera ratios to estimate snow quality (powder, dry_snow, wet_snow, sleet/mix, rain)
- Endpoints: `GET /all` (all resorts), `GET /:resortName` (single resort)

### Frontend Data Flow
1. `useWeatherData` hook fetches from backend `/all` endpoint on mount
2. `processResortData()` in `utils/weather.ts` transforms API data into `ProcessedResortData` for display
3. Resort hierarchy defined in `data/resortHierarchy.ts` - single source of truth for resort names and groupings (by region/country)
4. `constants.ts` exports `skiResorts` (API IDs) derived from the hierarchy

### Key Frontend Patterns
- State persisted to localStorage via `useLocalStorage` hook
- Command palette (`Ctrl+K`) for settings - commands defined in `App.tsx`, generated by `utils/commandGenerators.ts`
- Three view modes: default, full, compact (cards in `components/cards/`)
- Theming via CSS custom properties (`--color-*`), themes in `types/themes.ts`
- Resort selection modal uses tree structure from `useResortHierarchy` hook

### Type System (`frontend/src/types/`)
- `index.ts` - Core types: `AllWeatherData`, `ResortData`, `ProcessedResortData`, `DayForecast`, `Period`
- `themes.ts` - Theme configuration
- `fonts.ts` - Font configuration

### Weather Data Types
- `PeriodData` - Raw API data for AM/PM/NIGHT periods with snow estimation fields
- `DayData` - Contains AM/PM/NIGHT `PeriodData`
- `ProcessedResortData` - Transformed for UI display with `DayForecast[]`

Task: Feature.md